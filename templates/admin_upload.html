<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Upload</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: system-ui, Arial;
  background:#f4f6f8;
  margin:0;
}
.box{
  max-width:520px;
  margin:40px auto;
  background:#fff;
  padding:30px;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
}
h2{
  margin-top:0;
}
.drop{
  border:2px dashed #4f46e5;
  padding:40px;
  border-radius:14px;
  text-align:center;
  cursor:pointer;
  margin-bottom:10px;
  transition:background .2s;
}
progress{
  width:100%;
  margin-top:15px;
  height:12px;
}
button{
  width:100%;
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#4f46e5;
  color:#fff;
  font-size:15px;
}
.stats{
  margin-top:15px;
  font-size:14px;
  color:#333;
}
.stats span{
  display:block;
  margin:4px 0;
}
.footer{
  text-align:center;
  margin-top:20px;
  font-size:12px;
  color:#666;
}
.warning{
  color:#dc2626;
  font-size:13px;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="box">
  <h2>ðŸ“¸ Admin Upload</h2>

  <p id="count">0 files selected</p>

  <div class="drop" id="dropBox">
    Drag & Drop photos here<br>or click to select
    <input type="file" id="file" multiple hidden>
  </div>

  <div class="warning" id="warn"></div>

  <progress id="bar" value="0" max="100"></progress>

  <div class="stats" id="stats" style="display:none">
    <span>ðŸ“¤ Uploaded: <b id="up">0</b></span>
    <span>ðŸ§  Indexed (face found): <b id="idx">0</b></span>
    <span>ðŸš« No face detected: <b id="noface">0</b></span>
  </div>

  <button onclick="upload()">Upload & Index</button>

  <div class="footer">
    Generated by <b>Kracken</b>
  </div>
</div>

<script>
let files = []
const MAX = 30

const dropBox = document.getElementById("dropBox")
const fileInput = document.getElementById("file")

// CLICK TO SELECT
dropBox.onclick = () => fileInput.click()

fileInput.onchange = e => {
  files = [...e.target.files]
  updateCount()
}

// PREVENT DEFAULT DRAG BEHAVIOR
;["dragenter","dragover","dragleave","drop"].forEach(evt=>{
  dropBox.addEventListener(evt, e => e.preventDefault())
})

// DRAG HIGHLIGHT
dropBox.addEventListener("dragover", ()=>{
  dropBox.style.background = "#eef2ff"
})
dropBox.addEventListener("dragleave", ()=>{
  dropBox.style.background = ""
})

// DROP FILES
dropBox.addEventListener("drop", e=>{
  files = [...e.dataTransfer.files]
  dropBox.style.background = ""
  updateCount()
})

function updateCount(){
  count.innerText = files.length + " files selected"
  warn.innerText = ""

  if(files.length > MAX){
    warn.innerText = "âš  Max 30 photos per upload. Please upload in batches."
  }
}

function upload(){
  if(files.length === 0){
    alert("Please select photos first")
    return
  }

  if(files.length > MAX){
    alert("Too many files. Upload max 30 at once.")
    return
  }

  bar.value = 0
  stats.style.display = "none"

  let form = new FormData()
  files.forEach(f => form.append("photos", f))

  let xhr = new XMLHttpRequest()
  xhr.open("POST", "/admin/upload")

  xhr.upload.onprogress = e => {
    if(e.lengthComputable){
      bar.value = (e.loaded / e.total) * 100
    }
  }

  xhr.onload = () => {
    alert(xhr.responseText)

    let txt = xhr.responseText
    let u = txt.match(/Uploaded:\s*(\d+)/)
    let i = txt.match(/Indexed.*:\s*(\d+)/)
    let n = txt.match(/No face.*:\s*(\d+)/)

    if(u){
      stats.style.display = "block"
      up.innerText = u[1]
      idx.innerText = i ? i[1] : 0
      noface.innerText = n ? n[1] : 0
    }
  }

  xhr.send(form)
}
</script>

</body>
</html>
